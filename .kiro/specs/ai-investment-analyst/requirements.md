# 需求文档

## 项目介绍

AI投资分析师"Value-Seeker"是一个端到端的AI投资研究助理，模拟著名投资者段永平的思维框架和语言风格，深度解析金融研报，提供有理有据、可追溯的投资洞见。系统通过先进的文档理解、专家风格生成和复杂的Prompt工程技术，为用户提供专业的投资分析服务。

核心价值主张包括：深度文档理解、专家风格生成、高级Prompt工程、可溯源与可信赖的分析、SOTA对齐技术实践，以及一键式Docker部署。

## 需求

### 需求 1

**用户故事：** 作为投资分析师，我希望能够上传PDF金融研报并获得段永平投资风格的智能分析，以便获得专业的投资洞见和准确的原文引用。

#### 验收标准

1. 当用户上传PDF金融研报时，系统应当准确解析文本和表格数据
2. 当系统处理文档时，系统应当提取元数据，包括来源、页码和文档类型
3. 当生成分析时，系统应当以段永平独特的投资理念和语言风格提供回答
4. 当提供投资洞见时，系统应当包含对原始文档来源的准确引用
5. 如果查询超出知识库范围，系统应当适当地拒绝回答

### 需求 2

**用户故事：** 作为用户，我希望系统能够从多个视角理解我的投资问题并提供全面的答案，以便获得涵盖不同角度的深入分析。

#### 验收标准

1. 当用户提交查询时，系统应当生成三种视角变体：直接查询、简化查询和扩展查询
2. 当处理查询时，系统应当使用两阶段检索（向量检索 + 重排序）来检索相关文档
3. 当生成回答时，系统应当使用反思修正链来提高答案质量
4. 当提供分析时，系统应当确保事实准确性、逻辑完整性和风格一致性
5. 当合并检索结果时，系统应当去重并优化相关性排序

### 需求 3

**用户故事：** 作为系统管理员，我希望能够在不同环境中轻松配置和部署系统，以便在本地和云端部署中保持一致的性能。

#### 验收标准

1. 当部署系统时，系统应当支持本地开发和云端生产环境
2. 当配置系统时，系统应当使用集中的YAML配置文件管理所有参数
3. 当启动服务时，系统应当能够通过`docker-compose up -d`成功启动
4. 当运行推理时，系统应当在10秒内响应每个查询
5. 当处理并发用户时，系统应当支持至少5个同时用户
6. 当使用内存时，系统应当控制在20GB以内

### 需求 4

**用户故事：** 作为研究人员，我希望评估和比较不同的模型对齐技术，以便使用DPO和KTO训练方法优化系统性能。

#### 验收标准

1. 当训练模型时，系统应当同时支持DPO和KTO对齐技术
2. 当评估性能时，系统应当达到Ragas faithfulness > 0.85、answer relevancy > 0.9、context precision > 0.8
3. 当评估风格对齐时，系统应当在LLM-as-a-Judge评估中得分 > 4.0/5.0
4. 当比较方法时，系统应当提供DPO vs KTO性能的详细分析
5. 当跟踪实验时，系统应当将所有训练指标记录到Weights & Biases
6. 当构建对齐数据集时，系统应当支持chosen/rejected对格式

### 需求 5

**用户故事：** 作为最终用户，我希望通过直观的Web界面与系统交互，以便轻松提问、查看回答和管理知识库。

#### 验收标准

1. 当访问界面时，系统应当提供基于Gradio的清洁Web应用程序
2. 当查看回答时，系统应当显示对话历史和来源引用
3. 当管理文档时，用户应当能够上传新的PDF报告并更新知识库
4. 当监控系统时，管理员应当看到实时系统状态和性能指标
5. 当使用界面时，界面应当响应迅速并流畅处理用户交互
6. 当展示引用时，系统应当在专门的区域显示引用文献

### 需求 6

**用户故事：** 作为开发者，我希望系统以高代码质量和可维护性标准构建，以便能够轻松扩展和长期维护。

#### 验收标准

1. 当审查代码时，代码应当包含完整的类型注解和详细的文档字符串
2. 当处理错误时，系统应当提供适当的异常处理和恢复机制
3. 当测试系统时，单元测试覆盖率应当超过80%
4. 当遵循标准时，代码风格应当符合PEP 8指南
5. 当记录事件时，系统应当维护用于调试和监控的全面日志
6. 当设计架构时，系统应当采用模块化设计，实现低耦合高内聚

### 需求 7

**用户故事：** 作为技术架构师，我希望系统采用先进的技术栈和架构设计，以便实现高性能的文档处理和智能分析能力。

#### 验收标准

1. 当选择基础模型时，系统应当使用Qwen2.5-7B-Instruct作为核心大模型
2. 当进行文本检索时，系统应当使用BAAI/bge-m3嵌入模型和BAAI/bge-reranker-large重排模型
3. 当存储向量时，系统应当使用FAISS (IndexHNSWFlat)实现高性能向量检索
4. 当处理文档时，系统应当使用unstructured和LangChain进行PDF解析和智能文本分块
5. 当进行模型微调时，系统应当支持transformers、peft、trl、bitsandbytes等工具
6. 当部署推理服务时，系统应当使用vLLM实现生产级推理性能

### 需求 8

**用户故事：** 作为质量保证工程师，我希望系统具备完善的评估和监控机制，以便确保系统输出的质量和可靠性。

#### 验收标准

1. 当进行自动化评估时，系统应当使用ragas框架进行量化指标评估
2. 当评估风格一致性时，系统应当实现LLM-as-a-Judge多维度评估
3. 当监控训练过程时，系统应当使用wandb进行实验管理和结果可视化
4. 当生成评估报告时，系统应当提供详细的性能分析和对比结果
5. 当检测异常时，系统应当能够识别并报告质量下降或错误情况
6. 当验证引用时，系统应当确保所有引用的准确性和可追溯性